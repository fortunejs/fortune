/*!
 * Fortune.js
 * Version 5.5.19
 * MIT License
 * http://fortune.js.org
 */
!function n(o,i,s){function u(r,e){if(!i[r]){if(!o[r]){var t="function"==typeof require&&require;if(!e&&t)return t(r,!0);if(a)return a(r,!0);throw(e=new Error("Cannot find module '"+r+"'")).code="MODULE_NOT_FOUND",e}t=i[r]={exports:{}},o[r][0].call(t.exports,function(e){return u(o[r][1][e]||e)},t,t.exports,n,o,i,s)}return i[r].exports}for(var a="function"==typeof require&&require,e=0;e<s.length;e++)u(s[e]);return u}({1:[function(i,e,u){!function(o){!function(){"use strict";var t=i("../../common/deep_equal"),k=i("../../common/message"),T=i("../../common/array/find"),e=i("../../common/generate_id"),O=i("../../common/errors").BadRequestError,r=i("../../common/keys"),_=r.primary,I=r.type,B=r.isArray,n=[[Date,function(e,r){return e.getTime()===r.getTime()}],[o,function(e,r){return e.equals(r)}],[Object,function(e,r){return t(e,r)}]],P=[[Number,function(e,r){return e-r}],[String,function(e,r){return e===r?0:r<e?1:-1}],[Boolean,function(e,r){return e===r?0:e?1:-1}],[Date,function(e,r){return e.getTime()-r.getTime()}],[o,o.compare],[Object,function(){return 0}]];function s(e,r,t){return null===t?null===r:e?e.compare?0===e.compare(r,t):(e=T(n,R(e)))?e[1](r,t):r===t:r===t}function U(e,r,t,n,o){for(var i in r)switch(i){case"and":if(function(e,r,t,n,o){var i;for(i=0;i<r.length;i++)if(!U(e,r[i],t,n,o))return;return 1}(e,r[i],t,n,o))break;return;case"or":if(function(e,r,t,n,o){var i;for(i=0;i<r.length;i++)if(U(e,r[i],t,n,o))return 1;return}(e,r[i],t,n,o))break;return;case"not":if(U(e,r[i],t,n,o))return;break;case"range":if(function(e,r,t){var n,o,i,s,u,a={};for(n in r)if(i=e[n],o=i[I],i=i[B],o||i){if(s=r[n],null==(u=t[n]))return;if(i&&(u=u?u.length:0),a[n]||(a[n]=i?T(P,R(Number))[1]:o.compare||T(P,R(o))[1]),null!==s[0]&&a[n](u,s[0])<0)return;if(null!==s[1]&&a[n](s[1],u)<0)return}return 1}(e,r[i],t))break;return;case"match":if(function(e,r,t){var n,o;for(n in r)if(o=r[n],Array.isArray(o)||(o=[o]),void 0===T(o,function(t,e){return function(r){return t[B]?T(e,function(e){return s(t[I],r,e)}):s(t[I],r,e)}}(e[n],t[n])))return;return 1}(e,r[i],t))break;return;case"exists":if(function(e,r,t){var n,o,i;for(n in r)if(o=t[n],i=e[n][B],r[n]){if(!o)return;if(i&&!o.length)return}else{if(o&&!i)return;if(i&&o.length)return}return 1}(e,r[i],t))break;return;case"fuzzyMatch":if(!function(e,r,t,n){for(const i of Object.keys(e)){var o=e[i];if(1<i.split(":").length){if(!function(e,r,t,n,o){const i=r.split(":"),s=n.recordTypes,u=s[o],a=function e(r,t,n,o){if(!n.length)return o;const i=n[0];const s=t[i].link;s&&(o.push(s),t=r[s]);return e(r,t,n.slice(1),o)}(s,u,i,[]),f=i.splice(-1),c=function e(r,t,n,o,i){if(!n.length)return t;const s=[];const u=n[0];const a=o[0];const f=r[u].isArray;for(const c of t){const l=f?c[u]:[c[u]];for(const p of l){const h=i.db[a][p];h&&s.push(h)}}return e(i.recordTypes[a],s,n.slice(1),o.slice(1),i)}(u,[e],i,a,n);return c.filter(e=>l(e,f,t)).length}(r,i,o,t,n))return}else if(!l(r,i,o))return}return 1}(r[i],t,n,o))return}return 1}function l(e,r,t){e=e[r];return String(e).toLowerCase().includes(String(t).toLowerCase())}function R(t){return function(e){var r=t===e[0]||t.name===e[0].name;if(!r)try{r=e[0]===t.prototype.constructor}catch(e){}return r}}u.generateId=e,u.applyOptions=function(e,r,t,n,o,i){var s,u,a,f,c,l,p,h,d,y,m,g,v,w,b,E,A;if(t=t||{},n=(n=n||{}).language,t)for(l=r,r=[],p=0,h=l.length;p<h;p++)u=l[p],U(e,t,u,o,i)&&r.push(u);if(s=r.length,"fields"in t){if(f=!T(Object.keys(t.fields),function(e){return!t.fields[e]}),c=!T(Object.keys(t.fields),function(e){return t.fields[e]}),!f&&!c)throw new O(k("FieldsFormat",n));for(p=0,h=r.length;p<h;p++)for(a in u=r[p])a!==_&&(f&&!t.fields.hasOwnProperty(a)||c&&t.fields.hasOwnProperty(a))&&delete u[a]}return"sort"in t&&(r=r.sort((d=e,y=t.sort,function(e,r){for(m in y){if(g=e[m],v=r[m],w=y[m],E=d[m],b=E[B],E=E[I],null===g)return 1;if(null===v)return-1;if(A=0,b)A=g.length-v.length;else if(E){if(!(b=E.compare||T(P,R(E))[1]))throw new Error('Missing "compare" function.');A=b(g,v)}if(0!==A)return w?A:-A}return 0}))),(r="limit"in t||"offset"in t?r.slice(t.offset,t.limit?(t.offset||0)+t.limit:r.length):r).count=s,r}}.call(this)}.call(this,i("buffer").Buffer)},{"../../common/array/find":8,"../../common/deep_equal":19,"../../common/errors":20,"../../common/generate_id":22,"../../common/keys":24,"../../common/message":25,buffer:47}],2:[function(e,r,t){"use strict";var l=e("../common").generateId;t.inputRecord=function(e,r){var t,n,o,i=this.recordTypes,s=this.keys.primary,u=this.keys.isArray,a=i[e],f=Object.getOwnPropertyNames(a),c={};c[s]=s in r?r[s]:l();for(t=0,n=f.length;t<n;t++)o=f[t],r.hasOwnProperty(o)?c[o]=r[o]:c[o]=a[o][u]?[]:null;return c},t.outputRecord=function(e,r){var t,n,o,i,s,u=this.recordTypes,a=this.keys.primary,f=this.keys.isArray,c=this.keys.denormalizedInverse,l=u[e],p=Object.getOwnPropertyNames(l),h={};for(h[a]=r[a],t=0,n=p.length;t<n;t++)o=p[t],s=(i=r.hasOwnProperty(o))?r[o]:l[o][f]?[]:null,l[o][c]?Object.defineProperty(h,o,{configurable:!0,writable:!0,value:s}):i&&(h[o]=s);return h}},{"../common":1}],3:[function(e,r,t){"use strict";var p=e("../../../common/apply_update"),m=e("../../../common/array/map"),g=e("../../../common/promise"),n=e("../common"),d=n.applyOptions,e=e("./helpers"),v=e.inputRecord,w=e.outputRecord;r.exports=function(h){function e(e){h.call(this,e),this.options||(this.options={}),"recordsPerType"in this.options||(this.options.recordsPerType=1e3)}return(e.prototype=new h).connect=function(){var e,r=g.Promise,t=this.recordTypes;for(e in this.db={},t)this.db[e]={};return r.resolve()},e.prototype.disconnect=function(){var e=g.Promise;return delete this.db,e.resolve()},e.prototype.find=function(e,r,t,n){var o,i,s,u,a=g.Promise,f=this,c=f.recordTypes[e],l=f.db[e],p=[];if(r&&!r.length)return h.prototype.find.call(f);if(r)for(o=0,i=r.length;o<i;o++)s=r[o],l.hasOwnProperty(s)&&(u=l[s],delete l[s],l[s]=u,p.push(w.call(f,e,u)));else for(s in l)p.push(w.call(f,e,l[s]));return a.resolve(d(c,p,t,n,f,e))},e.prototype.create=function(r,e,t){for(var n,o,i,s=g.Promise,u=this,a=u.message,f=u.options.recordsPerType,c=u.keys.primary,l=u.errors.ConflictError,p=u.db[r],h=(t=t||{}).language,d=0,y=(e=m(e,function(e){return v.call(u,r,e)})).length;d<y;d++)if(o=(n=e[d])[c],p.hasOwnProperty(o))return s.reject(new l(a("RecordExists",h,{id:o})));for(d=0,y=e.length;d<y;d++)p[(n=e[d])[c]]=n;if(f&&(i=Object.keys(p)).length>f)for(y=(i=i.slice(d=0,i.length-f)).length;d<y;d++)delete p[i[d]];return s.resolve(m(e,function(e){return w.call(u,r,e)}))},e.prototype.update=function(e,r){var t,n,o,i,s,u=g.Promise,a=this,f=a.keys.primary,c=a.db[e],l=0;if(!r.length)return h.prototype.update.call(a);for(t=0,n=r.length;t<n;t++)(s=c[i=(o=r[t])[f]])&&(l++,s=w.call(a,e,s),p(s,o),delete c[i],c[i]=v.call(a,e,s));return u.resolve(l)},e.prototype.delete=function(e,r){var t,n,o,i=g.Promise,s=this.db[e],u=0;if(r&&!r.length)return h.prototype.delete.call(this);if(r)for(t=0,n=r.length;t<n;t++)s[o=r[t]]&&(delete s[o],u++);else for(o in s)delete s[o],u++;return i.resolve(u)},e.common=n,e.features={logicalOperators:!0},e}},{"../../../common/apply_update":6,"../../../common/array/map":10,"../../../common/promise":28,"../common":1,"./helpers":2}],4:[function(e,r,t){"use strict";var n=e("../common/assign"),o=e("../common/promise"),e=e("./adapters/memory");function i(e){n(this,e)}i.prototype.constructor=function(){},delete i.prototype.constructor,i.prototype.connect=function(){return o.Promise.resolve()},i.prototype.disconnect=function(){return o.Promise.resolve()},i.prototype.create=function(){return o.Promise.resolve([])},i.prototype.find=function(){var e=o.Promise,r=[];return r.count=0,e.resolve(r)},i.prototype.update=function(){return o.Promise.resolve(0)},i.prototype.delete=function(){return o.Promise.resolve(0)},i.prototype.beginTransaction=function(){return o.Promise.resolve(this)},i.prototype.endTransaction=function(){return o.Promise.resolve()},i.prototype.applyOperators=function(e){return e},i.DefaultAdapter=e(i),i.features={},r.exports=i},{"../common/assign":14,"../common/promise":28,"./adapters/memory":3}],5:[function(e,r,t){"use strict";var n=e("./"),o=e("../common"),i=e("../common/errors"),s=e("../common/keys"),u=e("../common/promise");r.exports=function(e){var r,t=Array.isArray(e.adapter)?e.adapter:[e.adapter];if("function"!=typeof t[0])throw new TypeError("The adapter must be a function.");if(r=n.prototype.isPrototypeOf(t[0].prototype)?t[0]:t[0](n),n.prototype.isPrototypeOf(r.prototype))return new r({options:t[1]||{},recordTypes:e.recordTypes,features:r.features,common:o,errors:i,keys:s,message:e.message,Promise:u.Promise});throw new TypeError("The adapter must inherit the Adapter class.")}},{"../common":23,"../common/errors":20,"../common/keys":24,"../common/promise":28,"./":4}],6:[function(e,r,t){"use strict";var n=e("./array/pull");r.exports=function(e,r){for(var t in r.replace)e[t]=r.replace[t];for(t in r.push)e[t]=(e[t]||[]).concat(r.push[t]);for(t in r.pull)e[t]=e[t]?n(e[t],r.pull[t]):[]}},{"./array/pull":11}],7:[function(e,r,t){"use strict";r.exports=function(e,r){for(var t=[],n=0,o=0,i=e.length;o<i;o++)r(e[o],o,e)&&(t[n++]=e[o]);return t}},{}],8:[function(e,r,t){"use strict";r.exports=function(e,r){for(var t,n=0,o=e.length;n<o;n++)if(r(t=e[n]))return t}},{}],9:[function(e,r,t){"use strict";r.exports=function(e,r){for(var t=0,n=e.length;t<n;t++)if(e[t]===r)return!0;return!1}},{}],10:[function(e,r,t){"use strict";r.exports=function(e,r){for(var t=[],n=0,o=0,i=e.length;o<i;o++)t[n++]=r(e[o],o,e);return t}},{}],11:[function(e,r,t){"use strict";r.exports=function(e,r){var t,n,o,i={},s=[];if(Array.isArray(r))for(n=0,o=r.length;n<o;n++)i[r[n]]=!0;else i[r]=!0;for(n=e.length;n--;)t=e[n],i.hasOwnProperty(t)||s.unshift(t);return s}},{}],12:[function(e,r,t){"use strict";r.exports=function(e,r,t){for(var n=t,o=0,i=e.length;o<i;o++)n=r(n,e[o],o,e);return n}},{}],13:[function(e,r,t){"use strict";r.exports=function(e){for(var r,t={},n=[],o=0,i=e.length;o<i;o++)r=e[o],t.hasOwnProperty(r)||(n.push(r),t[r]=!0);return n}},{}],14:[function(e,r,t){"use strict";r.exports=function(e){for(var r,t,n=1,o=arguments.length;n<o;n++)if(null!=(t=arguments[n]))for(r in t)e[r]=t[r];return e}},{}],15:[function(e,r,t){"use strict";r.exports=function(e){var r=Number.parseFloat(e);return 0<=e-r+1?r:e}},{}],16:[function(r,s,e){!function(t){!function(){"use strict";var e=r("./errors"),n=r("./message"),a=r("./cast_to_number"),o=e.BadRequestError,i=t.from||function(e,r){return new t(e,r)},f=[[Number,function(e){return parseFloat(e)}],[Date,function(e,r){if("string"==typeof e&&(e=Date.parse(e),Number.isNaN(e)))throw new o(n("DateISO8601",r.language));if(e=new Date(e),Number.isNaN(e.getTime()))throw new o(n("DateInvalid",r.language));return e}],[t,function(e,r){var t=r&&r.bufferEncoding?r.bufferEncoding:"base64";if("string"!=typeof e)throw new o(n("BufferEncoding",r.language,{bufferEncoding:t}));return i(e,t)}],[Boolean,function(e){return"string"==typeof e?/^(?:true|1|yes|t|y)$/i.test(e):Boolean(e)}],[Object,function(e,r){if("string"==typeof e)return JSON.parse(e);if("object"==typeof e)return e;throw new o(n("JSONParse",r.language))}],[String,function(e){return""+e}]];s.exports=function(e,r,t){var n,o,i,s,u;if(""===e)return null;if(!r)return a(e);for(n=0,o=f.length;n<o;n++){if(!(s=(i=f[n])[0]===r||i[0].name===r.name))try{s=i[0]===r.prototype.constructor}catch(e){}if(s){u=i[1];break}}return u&&null!==e?u(e,t):e}}.call(this)}.call(this,r("buffer").Buffer)},{"./cast_to_number":15,"./errors":20,"./message":25,buffer:47}],17:[function(e,r,t){"use strict";r.exports=function e(r){var t,n,o,i;if(Array.isArray(r))i=!0;else if(null==r||Object.getPrototypeOf(r)!==Object.prototype)return r;for(n in t=i?[]:{},r)o=r[n],t[n]=null!=o&&Object.getPrototypeOf(o)===Object.prototype||Array.isArray(o)?e(o):o;return t}},{}],18:[function(e,r,t){"use strict";var n,o,i,s="function"==typeof Symbol,u=["denormalizedInverse","updateRecord","linkedHash"];for(t.primary="id",t.type="type",t.link="link",t.inverse="inverse",t.isArray="isArray",n=0,o=u.length;n<o;n++)t[i=u[n]]=s?Symbol(i):"__"+i+"__";t.change="change",t.sync="sync",t.connect="connect",t.disconnect="disconnect",t.failure="failure",t.find="find",t.create="create",t.update="update",t.delete="delete"},{}],19:[function(e,r,t){!function(a){!function(){"use strict";r.exports=function e(r,t){var n,o,i,s=0,u=0;if(r===t)return!0;if(!r||!t)return!1;if(r.prototype!==t.prototype)return!1;for(n in r){if(s++,o=r[n],i=t[n],"object"==typeof o){if("object"==typeof i&&e(o,i))continue;return!1}if(a.isBuffer(o)){if(a.isBuffer(i)&&o.equals(i))continue;return!1}if(o&&"function"==typeof o.getTime){if(i&&"function"==typeof i.getTime&&o.getTime()===i.getTime())continue;return!1}if(o!==i)return!1}for(n in t)u++;return s===u}}.call(this)}.call(this,{isBuffer:e("../../node_modules/is-buffer/index.js")})},{"../../node_modules/is-buffer/index.js":51}],20:[function(e,r,t){"use strict";e=e("./response_classes");t.BadRequestError=e.BadRequestError,t.UnauthorizedError=e.UnauthorizedError,t.ForbiddenError=e.ForbiddenError,t.NotFoundError=e.NotFoundError,t.MethodError=e.MethodError,t.NotAcceptableError=e.NotAcceptableError,t.ConflictError=e.ConflictError,t.UnsupportedError=e.UnsupportedError,t.UnprocessableError=e.UnprocessableError,t.nativeErrors=e.nativeErrors},{"./response_classes":29}],21:[function(e,r,t){"use strict";e=e("./constants");t.change=e.change,t.sync=e.sync,t.connect=e.connect,t.disconnect=e.disconnect,t.failure=e.failure},{"./constants":18}],22:[function(e,r,t){"use strict";var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",o=n.length;r.exports=function(){for(var e=[],r=0;r<15;r++)e.push(n.charAt(Math.floor(Math.random()*o)));return e.join("")}},{}],23:[function(e,r,t){"use strict";r.exports={constants:e("./constants"),keys:e("./keys"),events:e("./events"),methods:e("./methods"),assign:e("./assign"),castToNumber:e("./cast_to_number"),castValue:e("./cast_value"),clone:e("./clone"),deepEqual:e("./deep_equal"),generateId:e("./generate_id"),applyUpdate:e("./apply_update"),message:e("./message"),responses:e("./response_classes"),errors:e("./errors"),successes:e("./success"),filter:e("./array/filter"),find:e("./array/find"),includes:e("./array/includes"),map:e("./array/map"),pull:e("./array/pull"),reduce:e("./array/reduce"),unique:e("./array/unique")}},{"./apply_update":6,"./array/filter":7,"./array/find":8,"./array/includes":9,"./array/map":10,"./array/pull":11,"./array/reduce":12,"./array/unique":13,"./assign":14,"./cast_to_number":15,"./cast_value":16,"./clone":17,"./constants":18,"./deep_equal":19,"./errors":20,"./events":21,"./generate_id":22,"./keys":24,"./message":25,"./methods":27,"./response_classes":29,"./success":30}],24:[function(e,r,t){"use strict";e=e("./constants");t.primary=e.primary,t.type=e.type,t.link=e.link,t.isArray=e.isArray,t.inverse=e.inverse,t.denormalizedInverse=e.denormalizedInverse},{"./constants":18}],25:[function(e,r,t){"use strict";var n,o={en:e("./messages/en")};for(n in o)a[n]=o[n];function a(e,r,t){var n,o,i,s="GenericError",u=this||a;if(u.hasOwnProperty(r)||(i=(i=r&&r.match(/.+?(?=-)/))&&i[0],r=u.hasOwnProperty(i)?i:u.defaultLanguage),"string"==typeof(n=u[r].hasOwnProperty(e)?u[r][e]:u[r][s]||u.en[s]))for(o in t)n=n.replace("{"+o+"}",t[o]);return n="function"==typeof n?n(t):n}r.exports=a,Object.defineProperty(a,"defaultLanguage",{value:"en",writable:!0})},{"./messages/en":26}],26:[function(e,r,t){r.exports={GenericError:function(e){return"An internal error occurred."},MalformedRequest:function(e){return"The request was malformed."},InvalidBody:function(e){return"The request body is invalid."},SerializerNotFound:function(e){return'The serializer for "'+e.id+'" does not exist.'},InputOnly:function(e){return"Input only."},InvalidID:function(e){return"An ID is invalid."},DateISO8601:function(e){return"Date string must be an ISO 8601 formatted string."},DateInvalid:function(e){return"Date value is invalid."},BufferEncoding:function(e){return"Buffer value must be a "+e.bufferEncoding+"-encoded string."},JSONParse:function(e){return"Could not parse value as JSON."},MissingPayload:function(e){return"Payload is missing."},SpecifiedIDs:function(e){return"IDs should not be specified."},InvalidURL:function(e){return"Invalid URL."},RelatedRecordNotFound:function(e){return'A related record for the field "'+e.field+'" was not found.'},CreateRecordsInvalid:function(e){return"There are no valid records to be created."},CreateRecordsFail:function(e){return"Records could not be created."},CreateRecordMissingID:function(e){return"An ID on a created record is missing."},DeleteRecordsMissingID:function(e){return"IDs are required for deleting records."},DeleteRecordsInvalid:function(e){return"A record to be deleted could not be found."},DeleteRecordsFail:function(e){return"Not all records specified could be deleted."},UnspecifiedType:function(e){return"The type is unspecified."},InvalidType:function(e){return'The requested type "'+e.type+'" is not a valid type.'},InvalidLink:function(e){return'The field "'+e.field+'" does not define a link.'},InvalidMethod:function(e){return'The method "'+e.method+'" is unrecognized.'},CollisionToOne:function(e){return'Multiple records can not have the same to-one link value on the field "'+e.field+'".'},CollisionDuplicate:function(e){return'Duplicate ID "'+e.id+'" in the field "'+e.field+'".'},UpdateRecordMissing:function(e){return"A record to be updated could not be found."},UpdateRecordsInvalid:function(e){return"There are no valid updates."},UpdateRecordMissingID:function(e){return"An ID on an update is missing."},EnforceArrayType:function(e){return'The value of "'+e.key+'" is invalid, it must be an array with values of type "'+e.type+'".'},EnforceArray:function(e){return'The value of "'+e.key+'" is invalid, it must be an array.'},EnforceSameID:function(e){return'An ID of "'+e.key+'" is invalid, it cannot be the same ID of the record.'},EnforceSingular:function(e){return'The value of "'+e.key+'" can not be an array, it must be a singular value.'},EnforceValue:function(e){return'The value of "'+e.key+'" is invalid, it must be a "'+e.type+'".'},EnforceValueArray:function(e){return'A value in the array of "'+e.key+'" is invalid, it must be a "'+e.type+'".'},FieldsFormat:function(e){return"Fields format is invalid. It may either be inclusive or exclusive, but not both."},RecordExists:function(e){return'A record with ID "'+e.id+'" already exists.'}}},{}],27:[function(e,r,t){"use strict";e=e("./constants");t.find=e.find,t.create=e.create,t.update=e.update,t.delete=e.delete},{"./constants":18}],28:[function(e,r,t){"use strict";t.Promise=Promise},{}],29:[function(e,r,t){"use strict";var n=e("error-class"),o=e("./assign");t.OK=function(e){o(this,e)},t.Created=function(e){o(this,e)},t.Empty=function(e){o(this,e)},t.BadRequestError=n("BadRequestError"),t.UnauthorizedError=n("UnauthorizedError"),t.ForbiddenError=n("ForbiddenError"),t.NotFoundError=n("NotFoundError"),t.MethodError=n("MethodError"),t.NotAcceptableError=n("NotAcceptableError"),t.ConflictError=n("ConflictError"),t.UnsupportedError=n("UnsupportedError"),t.UnprocessableError=n("UnprocessableError"),t.nativeErrors=[Error,TypeError,ReferenceError,RangeError,SyntaxError,EvalError,URIError]},{"./assign":14,"error-class":48}],30:[function(e,r,t){"use strict";e=e("./response_classes");t.OK=e.OK,t.Created=e.Created,t.Empty=e.Empty},{"./response_classes":29}],31:[function(e,r,t){"use strict";window.fortune=e("./")},{"./":32}],32:[function(e,r,t){"use strict";var n=e("event-lite"),h=e("./adapter/adapters/memory"),d=e("./adapter/singleton"),y=e("./record_type/validate"),o=e("./record_type/ensure_types"),i=e("./common/promise"),s=e("./request"),m=s.middlewares,g=e("./adapter"),v=e("./common"),e=v.assign,w=v.methods,u=v.events;function a(e,r){if(!(this instanceof a))return new a(e,r);this.constructor(e,r)}(a.prototype=new n).constructor=function(e,r){var t,n,o,i,s,u,a,f,c=this,l={},p=v.message;for(n in void 0===e&&(e={}),"adapter"in(r=void 0===r?{}:r)||(r.adapter=[h(g)]),"settings"in r||(r.settings={}),"hooks"in r||(r.hooks={}),"enforceLinks"in r.settings||(r.settings.enforceLinks=!0),i={},w){for(a=0,f=(o=[m[n],m.include,m.end]).length;a<f;a++)o[a]=function(r,t){return function(e){return t.call(r,e)}}(c,o[a]);i[w[n]]=o}for(s in u=r.hooks){if(!e.hasOwnProperty(s))throw new Error('Attempted to define hook on "'+s+'" type which does not exist.');if(!Array.isArray(u[s]))throw new TypeError('Hook value for "'+s+'" type must be an array.')}for(s in e){if(s in l)throw new Error('Can not define type name "'+s+'" which is in Object.prototype.');y(e[s]),u.hasOwnProperty(s)||(u[s]=[])}t=new d({adapter:r.adapter,recordTypes:e,hooks:u,message:p}),c.options=r,c.hooks=u,c.recordTypes=e,c.adapter=t,Object.defineProperties(c,{connectionStatus:{value:0,writable:!0},message:{value:p},flows:{value:i}})},a.prototype.request=function(t){var n=this,e=n.connectionStatus,r=i.Promise;return 0===e?n.connect().then(function(){return s.call(n,t)}):1===e?new r(function(e,r){n.once(u.failure,function(){r(new Error("Connection failed."))}),n.once(u.connect,function(){e(s.call(n,t))})}):s.call(n,t)},a.prototype.find=function(e,r,t,n,o){e={method:w.find,type:e};return r&&(e.ids=Array.isArray(r)?r:[r]),t&&(e.options=t),n&&(e.include=n),o&&(e.meta=o),this.request(e)},a.prototype.create=function(e,r,t,n){e={method:w.create,type:e,payload:Array.isArray(r)?r:[r]};return t&&(e.include=t),n&&(e.meta=n),this.request(e)},a.prototype.update=function(e,r,t,n){e={method:w.update,type:e,payload:Array.isArray(r)?r:[r]};return t&&(e.include=t),n&&(e.meta=n),this.request(e)},a.prototype.delete=function(e,r,t,n){e={method:w.delete,type:e};return r&&(e.ids=Array.isArray(r)?r:[r]),t&&(e.include=t),n&&(e.meta=n),this.request(e)},a.prototype.connect=function(){var t=this,e=i.Promise;return 1===t.connectionStatus?e.reject(new Error("Connection is in progress.")):2===t.connectionStatus?e.reject(new Error("Connection is already done.")):(t.connectionStatus=1,new e(function(e,r){Object.defineProperty(t,"denormalizedFields",{value:o(t.recordTypes),writable:!0,configurable:!0}),t.adapter.connect().then(function(){return t.connectionStatus=2,t.emit(u.connect),e(t)},function(e){return t.connectionStatus=0,t.emit(u.failure),r(e)})}))},a.prototype.disconnect=function(){var t=this,e=i.Promise;return 2!==t.connectionStatus?e.reject(new Error("Instance has not been connected.")):(t.connectionStatus=1,new e(function(e,r){return t.adapter.disconnect().then(function(){return t.connectionStatus=0,t.emit(u.disconnect),e(t)},function(e){return t.connectionStatus=2,t.emit(u.failure),r(e)})}))},a.prototype.common=v,e(a,{Adapter:g,adapters:{memory:h(g)},errors:v.errors,message:v.message,methods:w,events:u}),Object.defineProperty(a,"Promise",{enumerable:!0,get:function(){return i.Promise},set:function(e){i.Promise=e}}),r.exports=a},{"./adapter":4,"./adapter/adapters/memory":3,"./adapter/singleton":5,"./common":23,"./common/promise":28,"./record_type/ensure_types":34,"./record_type/validate":35,"./request":42,"event-lite":49}],33:[function(t,n,e){!function(r){!function(){"use strict";var c=t("../common/message"),l=t("../common/array/find"),p=t("../common/errors").BadRequestError,e=t("../common/keys"),h=e.primary,d=e.type,y=e.link,m=e.isArray,s=[[String,function(e){return"string"==typeof e}],[Number,function(e){return"number"==typeof e}],[Boolean,function(e){return"boolean"==typeof e}],[Date,function(e){return e&&"function"==typeof e.getTime&&!Number.isNaN(e.getTime())}],[Object,function(e){return null!==e&&"object"==typeof e}],[r,function(e){return r.isBuffer(e)}]];function g(e,r,t,n){var o,n=n.language,i=e[d];if(null!==t&&!(o=(o=l(s,function(e){return i&&(e[0]===i||e[0].name===i.name)}))?o[1]:i)(t))throw new p(c(e[m]?"EnforceValueArray":"EnforceValue",n,{key:r,type:i.displayName||i.name}))}n.exports=function(e,r,t,n){var o,i,s,u,a,f=(n=n||{}).language;for(s in r)if(a=t[s]){if(u=r[s],a[d])if(a[m]){if(!Array.isArray(u))throw new p(c("EnforceArrayType",f,{key:s,type:a[d].name}));for(o=0,i=u.length;o<i;o++)g(a,s,u[o],n)}else g(a,s,u,n);else if(a[y])if(a[m]){if(!Array.isArray(u))throw new p(c("EnforceArray",f,{key:s}));if(e===a[y]&&l(u,function(r){return function(e){return r===e}}(r[h])))throw new p(c("EnforceSameID",f,{key:s}))}else{if(Array.isArray(u))throw new p(c("EnforceSingular",f,{key:s}));if(e===a[y]&&r[h]===u)throw new p(c("EnforceSameID",f,{key:s}))}}else s!==h&&delete r[s];return r}}.call(this)}.call(this,t("buffer").Buffer)},{"../common/array/find":8,"../common/errors":20,"../common/keys":24,"../common/message":25,buffer:47}],34:[function(e,r,t){"use strict";var e=e("../common/keys"),u=e.link,a=e.inverse,f=e.isArray,c=e.denormalizedInverse;r.exports=function(e){var r,t,n,o,i,s={};for(r in e)for(t in e[r])if(i=e[r][t],u in i){if(!e.hasOwnProperty(i[u]))throw new Error('The value for "'+u+'" on "'+t+'" in type "'+r+'" is invalid, the record type does not exist.');if(n=e[i[u]],a in i){if(!n.hasOwnProperty(i[a]))throw new Error('The value for "'+a+'" on "'+t+'" in type "'+r+'" is invalid, the field does not exist.');if(n[i[a]][a]!==t)throw new Error('The value for "'+a+'" on "'+t+'" in type "'+r+'" is invalid, the inversely related field must define its inverse as "'+t+'".');if(n[i[a]][u]!==r)throw new Error('The value for "'+u+'" on "'+t+'" in type "'+r+'" is invalid, the inversely related field must define its link as "'+r+'".')}else s[o="__"+r+"_"+t+"_inverse"]=!0,Object.defineProperty(i,a,{value:o}),(i={})[u]=r,i[a]=t,i[f]=!0,i[c]=!0,Object.defineProperty(n,o,{value:i,writable:!0,configurable:!0})}return s}},{"../common/keys":24}],35:[function(p,h,e){!function(t){!function(){"use strict";var n=p("../common/array/find"),e=p("../common/array/map"),r=p("../common/keys"),o=r.primary,i=r.type,s=r.link,u=r.inverse,a=r.isArray,f={},c=[String,Number,Boolean,Date,Object,t],l=e(c,function(e){return e.name&&e.name.toLowerCase()});h.exports=function(e){if("object"!=typeof e)throw new TypeError("Type definition must be an object.");for(var r in e)!function(e,r){var t=e[r]=function(e){var r;if("string"==typeof e)r={link:e};else if("function"==typeof e)r={type:e};else{if(!Array.isArray(e))return e;r={},e[1]?r.inverse=e[1]:r.isArray=!0,"string"==typeof(e=(Array.isArray(e[0])?(r.isArray=!0,e[0]):e)[0])?r.link=e:"function"==typeof e&&(r.type=e)}return r}(e[r]);if("object"!=typeof t)throw new TypeError('The definition of "'+r+'" must be an object.');if(r===o)throw new Error('Can not define primary key "'+o+'".');if(r in f)throw new Error('Can not define field name "'+r+'" which is in Object.prototype.');if(!t[i]&&!t[s])throw new Error('The definition of "'+r+'" must contain either the "'+i+'" or "'+s+'" property.');if(t[i]&&t[s])throw new Error('Can not define both "'+i+'" and "'+s+'" on "'+r+'".');if(t[i]){if("string"==typeof t[i]&&(t[i]=c[l.indexOf(t[i].toLowerCase())]),"function"!=typeof t[i])throw new Error('The "'+i+'" on "'+r+'" must be a function.');if(!n(c,function(e){var r=e===t[i]||e.name===t[i].name;if(!r)try{r=Object.create(t[i])instanceof e}catch(e){r=!0}return r}))throw new Error('The "'+i+'" on "'+r+'" must be or inherit from a valid native type.');if(t[u])throw new Error('The field "'+u+'" may not be defined on "'+r+'".')}if(t[s]){if("string"!=typeof t[s])throw new TypeError('The "'+s+'" on "'+r+'" must be a string.');if(t[u]&&"string"!=typeof t[u])throw new TypeError('The "'+u+'" on "'+r+'" must be a string.')}if(t[a]&&"boolean"!=typeof t[a])throw new TypeError('The key "'+a+'" on "'+r+'" must be a boolean.')}(e,r);return e}}.call(this)}.call(this,p("buffer").Buffer)},{"../common/array/find":8,"../common/array/map":10,"../common/keys":24,buffer:47}],36:[function(e,r,t){"use strict";var l=e("../common/message"),u=e("../common/promise"),p=e("../common/array/unique"),h=e("../common/array/map"),d=e("../common/array/includes"),y=e("../common/errors").BadRequestError,e=e("../common/keys"),m=e.primary,g=e.link,v=e.isArray,w=e.inverse;r.exports=function(n,o,i,s,a){var f=u.Promise,c=this.options.settings.enforceLinks;return f.all(h(s,function(s){var u=Array.isArray(o[s])?o[s]:o.hasOwnProperty(s)&&null!==o[s]?[o[s]]:[],e=i[s][g],r=i[s][w],t={fields:{}};return t.fields[r]=!0,new f(function(o,i){return u.length?n.find(e,u,t,a).then(function(e){var r,t,n;if(c)for(r=p(h(e,function(e){return e[m]})),t=0,n=u.length;t<n;t++)if(!d(r,u[t]))return i(new y(l("RelatedRecordNotFound",a.language,{field:s})));return o(e)}):o()})})).then(function(e){for(var r,t={},n=0,o=e.length;n<o;n++)(r=e[n])&&(t[s[n]]=i[s[n]][v]?r:r[0]);return t})}},{"../common/array/includes":9,"../common/array/map":10,"../common/array/unique":13,"../common/errors":20,"../common/keys":24,"../common/message":25,"../common/promise":28}],37:[function(e,r,t){"use strict";var s=e("./validate_records"),u=e("./check_links"),a=e("../record_type/enforce"),j=e("../common/message"),f=e("../common/promise"),S=e("../common/array/map"),q=e("../common/errors").BadRequestError,n=e("./update_helpers"),c=n.scrubDenormalizedUpdates,C=n.getUpdate,D=n.addId,M=n.removeId,n=e("../common/constants"),l=n.change,p=n.create,h=n.update,N=n.primary,L=n.link,F=n.inverse,z=n.isArray,d=n.denormalizedInverse;r.exports=function(E){var A,k,T,O,o,_,I,B=f.Promise,t=this,n=t.denormalizedFields,P=t.recordTypes,i=t.hooks,U={},R=[],x=[];return B.resolve(E.request.payload).then(function(e){var r,t,n;if(!(k=e)||!k.length)throw new q(j("CreateRecordsInvalid",I));for(n in T=E.request.type,O=E.request.meta,A=E.transaction,I=O.language,o=i[T],_=P[T])if(L in _[n]&&R.push(n),d in _[n])for(r=0,t=k.length;r<t;r++)delete k[r][n];return"function"==typeof o[0]?B.all(S(k,function(e){return o[0](E,e)})):k}).then(function(e){return B.all(S(e,function(r,e){return r&&"object"==typeof r?k[e]=r:r=k[e],a(T,r,_,O),u.call(t,A,r,_,R,O).then(function(e){return x.push(e),r})}))}).then(function(){return s.call(t,k,_,R,O),A.create(T,k,O)}).then(function(e){var r,t,n,o,i,s,u,a,f,c,l,p,h,d,y,m,g,v,w,b={};if(!e.length)throw new q(j("CreateRecordsFail",I));for(k=e,Object.defineProperty(E.response,"records",{configurable:!0,value:k}),p=0,h=k.length;p<h;p++){if(r=k[p],i=x[p],!(N in r))throw new Error(j("CreateRecordMissingID",I));for(d=0,y=R.length;d<y;d++)if(n=_[t=R[d]][F],r.hasOwnProperty(t)&&n){for(s=_[t][L],u=P[s][n][z],a=(o=_[t][z])?r[t]:[r[t]],U[s]||(U[s]=[]),b[s]||(b[s]={}),m=0,g=a.length;m<g;m++)null!==(f=a[m])&&D(r[N],C(s,f,U,b),n,u),o||!i[t]||null===i[t][n]||u||i[t][n]===r[N]||M(f,C(T,i[t][n],U,b),t,u);if(o&&i[t]&&!u)for(v=0,w=(l=Array.isArray(i[t])?i[t]:[i[t]]).length;v<w;v++)(c=l[v])[n]!==r[N]&&M(c[N],C(T,c[n],U,b),t,o)}}return B.all(S(Object.keys(U),function(e){return U[e].length?A.update(e,U[e],O):null}))}).then(function(){var e,r={};for(e in r[p]={},r[p][T]=k,U)c(U[e],n),U[e].length&&(h in r||(r[h]={}),r[h][e]=U[e]);return t.emit(l,r),E})}},{"../common/array/map":10,"../common/constants":18,"../common/errors":20,"../common/message":25,"../common/promise":28,"../record_type/enforce":33,"./check_links":36,"./update_helpers":44,"./validate_records":45}],38:[function(e,r,t){"use strict";var O=e("../common/message"),u=e("../common/promise"),_=e("../common/array/map"),a=e("../common/errors").NotFoundError,n=e("./update_helpers"),f=n.scrubDenormalizedUpdates,I=n.getUpdate,B=n.removeId,n=e("../common/constants"),c=n.change,l=n.delete,p=n.update,P=n.primary,U=n.link,R=n.inverse,x=n.isArray;r.exports=function(t){var e,y,m=u.Promise,n=this,o=n.denormalizedFields,r=t.request,i=r.type,g=r.ids,v=r.meta,w=v.language,b=n.recordTypes,r=n.hooks,E={},A=b[i],s=r[i],k=[],T=t.transaction;for(e in A)U in A[e]&&k.push(e);for(e in o)e in A&&k.push(e);if(g&&g.length)return T.find(i,g,null,v).then(function(e){if((y=e).length<g.length)throw new a(O("DeleteRecordsInvalid",w));return Object.defineProperty(t.response,"records",{configurable:!0,value:y}),"function"==typeof s[0]?m.all(_(y,function(e){return s[0](t,e)})):y}).then(function(){return T.delete(i,g,v)}).then(function(e){var r,t,n,o,i,s,u,a,f,c,l,p,h,d={};if(e<g.length)throw new Error(O("DeleteRecordsFail",w));for(r=0,t=y.length;r<t;r++)for(u=y[r],n=0,o=k.length;n<o;n++)if(c=A[a=k[n]][R],u.hasOwnProperty(a)&&c)for(l=A[a][U],p=b[l][c][x],h=Array.isArray(u[a])?u[a]:[u[a]],E[l]||(E[l]=[]),d[l]||(d[l]={}),i=0,s=h.length;i<s;i++)null!==(f=h[i])&&B(u[P],I(l,f,E,d),c,p);return m.all(_(Object.keys(E),function(e){return E[e].length?T.update(e,E[e],v):null}))}).then(function(){var e,r={};for(e in r[l]={},r[l][i]=g,E)f(E[e],o),E[e].length&&(p in r||(r[p]={}),r[p][e]=E[e]);return n.emit(c,r),t});throw new a(O("DeleteRecordsMissingID",w))}},{"../common/array/map":10,"../common/constants":18,"../common/errors":20,"../common/message":25,"../common/promise":28,"./update_helpers":44}],39:[function(e,r,t){"use strict";var c=e("../common/array/map"),i=e("../common/promise");r.exports=function(n){var o=i.Promise,s=this.hooks,u=n.request,e=n.response,r=u.type,t=s[r],a=e.records,f=e.include;return(a?o.all(c(a,function(e){return o.resolve("function"==typeof t[1]?t[1](n,e):e)})).then(function(e){for(var i,r=0,t=e.length;r<t;r++)e[r]&&(a[r]=e[r]);if(f)return i=Object.keys(f),o.all(c(i,function(r){return u.includeType=r,o.all(c(f[r],function(e){return o.resolve("function"==typeof s[r][1]?s[r][1](n,e):e)}))})).then(function(e){var r,t,n,o;for(delete u.includeType,r=0,t=e.length;r<t;r++)for(n=0,o=e[r].length;n<o;n++)e[r][n]&&(f[i[r]][n]=e[r][n])})}):o.resolve()).then(function(){return delete e.records,delete e.include,n.response.payload={records:a},f&&(n.response.payload.include=f),a&&"count"in a&&(n.response.payload.count=a.count),n})}},{"../common/array/map":10,"../common/promise":28}],40:[function(e,r,t){"use strict";r.exports=function(r){var e=r.transaction,t=r.request,n=t.type,o=t.ids,i=t.options,t=t.meta;return n?e.find(n,o,i,t).then(function(e){return Object.defineProperty(r.response,"records",{configurable:!0,value:e}),r}):r}},{}],41:[function(e,r,t){"use strict";var a=e("../common/promise"),f=e("../common/array/map"),c=e("../common/array/find"),b=e("../common/array/reduce"),E=e("../common/message"),A=e("../common/errors").BadRequestError,e=e("../common/keys"),k=e.primary,T=e.link;r.exports=function(r){var e,t,n,p=a.Promise,o=r.request,h=o.type,i=o.ids||[],s=o.include,d=o.meta,y=d.language,o=r.response,m=r.transaction,g=o.records,v=this.recordTypes,w=!0,u={};if(!h||!s||!g)return r;for(u[h]={},e=0,t=i.length;e<t;e++)u[h][i[e]]=!0;if(!i.length)for(e=0,t=g.length;e<t;e++)n=g[e][k],u[h][n]||(u[h][n]=!0);return s.length&&!Array.isArray(s[0])&&(s=[s]),p.all(f(s,function(l){return new p(function(r,t){for(var u,n,o,i,e,a=h,f=[],s=0,c=(l=Array.isArray(l)&&(Array.isArray(l[1])||"object"!=typeof l[1])?l:[l]).length;s<c;s++)Array.isArray(l[s])&&(f[s]=l[s][1],l[s]=l[s][0]);for(s=0,c=g.length;s<c;s++)if(!(l[0]in g[s])){w=!1;break}if(w)e=p.resolve(g);else{for((o={fields:{}}).fields[l[0]]=!0,n=[],s=0,c=g.length;s<c;s++)n.push(g[s][k]);e=m.find(h,n,o,d)}return e.then(function(e){return b(l,function(e,s,r){return e.then(function(e){if(i=v[a][s],!a||!i)return[];if(T in i)return u={},a=i[T],n=b(e,function(e,r){for(var t,n=Array.isArray(r[s])?r[s]:[r[s]],o=0,i=n.length;o<i;o++)(t=n[o])&&!u[t]&&(u[t]=!0,e.push(t));return e},[]),r in f?o=f[r]:r<l.length-1?(o={fields:{}}).fields[l[r+1]]=!0:o=null,n.length?m.find(a,n,o,d):[];throw new A(E("InvalidLink",y,{field:s}))})},p.resolve(e))}).then(function(e){return r({type:a,ids:n,records:e})},function(e){return t(e)})})})).then(function(e){e=b(e,function(e,r){var t,n,o,i;if(r.ids.length){for(e[r.type]||(e[r.type]=[]),u[r.type]||(u[r.type]={}),t=0,n=r.ids.length;t<n;t++)o=r.ids[t],u[r.type][o]||(i=c(r.records,function(r){return function(e){return e[k]===r}}(o)))&&(u[r.type][o]=!0,e[r.type].push(i));e[r.type].length||delete e[r.type]}return e},{});return Object.keys(e).length&&Object.defineProperty(r.response,"include",{configurable:!0,value:e}),r})}},{"../common/array/find":8,"../common/array/map":10,"../common/array/reduce":12,"../common/errors":20,"../common/keys":24,"../common/message":25,"../common/promise":28}],42:[function(e,r,t){"use strict";var n=e("../common/promise"),p=e("../common/assign"),h=e("../common/array/unique"),d=e("../common/message"),o=e("../common/response_classes"),y=o.BadRequestError,m=o.NotFoundError,g=o.MethodError,v=o.OK,w=o.Empty,b=o.Created,o=e("../common/methods"),E=o.find,A=o.create;function i(o){var e,i=n.Promise,s=this.flows,u=this.recordTypes,a=this.adapter,f=(p((e={request:{method:E,type:null,ids:null,options:{},include:[],meta:{},payload:null},response:{meta:{},payload:null}}).request,o),e),c=f.request.method,l="transaction"in o;return i.resolve(f).then(function(e){var r=e.request.type,t=e.request.ids,n=e.request.meta.language;if(t&&(e.request.ids=h(t)),null===r)throw(e=new y(d("UnspecifiedType",n))).isTypeUnspecified=!0,e;if(!u.hasOwnProperty(r))throw new m(d("InvalidType",n,{type:r}));if(c in s)return l?i.resolve(o.transaction):a.beginTransaction();throw new g(d("InvalidMethod",n,{method:c}))}).then(function(e){var r,t,n,o;for(f.transaction=e,r=i.resolve(f),n=0,o=(t=s[c]).length;n<o;n++)r=r.then(t[n]);return r}).then(function(t){return l?i.resolve():t.transaction.endTransaction().then(function(){var e=t.request.method,r=t.response;return new(r.payload?e===A?b:v:w)(r)})}).catch(function(e){return"transaction"in f&&!l?f.transaction.endTransaction(e).then(r,r):r();function r(){throw p(e,f.response)}})}i.middlewares={create:e("./create"),delete:e("./delete"),update:e("./update"),find:e("./find"),include:e("./include"),end:e("./end")},r.exports=i},{"../common/array/unique":13,"../common/assign":14,"../common/message":25,"../common/methods":27,"../common/promise":28,"../common/response_classes":29,"./create":37,"./delete":38,"./end":39,"./find":40,"./include":41,"./update":43}],43:[function(e,r,t){"use strict";var a=e("../common/deep_equal"),n=e("../common/promise"),d=e("../common/assign"),y=e("../common/clone"),m=e("./validate_records"),g=e("./check_links"),v=e("../record_type/enforce"),w=e("../common/message"),b=e("../common/apply_update"),o=e("./update_helpers"),i=o.scrubDenormalizedUpdates,U=o.getUpdate,R=o.addId,x=o.removeId,o=e("../common/errors"),j=o.NotFoundError,S=o.BadRequestError,q=e("../common/array/find"),C=e("../common/array/includes"),D=e("../common/array/map"),o=e("../common/constants"),M=o.change,N=o.update,L=o.primary,F=o.link,z=o.inverse,V=o.isArray,J=o.denormalizedInverse,K=o.updateRecord,Y=o.linkedHash;r.exports=function(f){var E,c,A,l,k,T,p,O=n.Promise,s=this,t=s.denormalizedFields,u=s.adapter,_=s.recordTypes,h=s.hooks,I={},B=[],P=[];return O.resolve(f.request.payload).then(function(e){var r,t,n,o,i,s,u=c=e,a=f.request.meta.language;if(!u||!u.length)throw new S(w("UpdateRecordsInvalid",a));for(i=0,s=u.length;i<s;i++)if(!u[i][L])throw new S(w("UpdateRecordMissingID",a));for(o in k=f.request.type,T=f.request.meta,E=f.transaction,p=T.language,A=_[k],l=h[k],A)if(F in A[o]&&P.push(o),J in A[o])for(r=0,t=c.length;r<t;r++)(n=c[r]).replace&&delete n.replace[o],n.pull&&delete n.pull[o],n.push&&delete n.push[o];return E.find(k,D(c,function(e){return e[L]}),null,T)}).then(function(e){if(e.length<c.length)throw new j(w("UpdateRecordMissing",p));return O.all(D(e,function(r){var t,n="function"==typeof l[0],o=r[L],i=q(c,function(e){return e[L]===o});if(i)return n&&(t=y(i)),O.resolve(n?l[0](f,r,i):i).then(function(e){if(e&&"object"==typeof e&&(i=e),n&&(a(i,t)||(f.response.meta.updateModified=!0),i[L]!==o))throw new S(w("InvalidID",p));return B.push(i),Object.defineProperty(i,K,{value:r}),r=d({},r),b(r,i),i.operate&&(r=u.applyOperators(r,i.operate)),v(k,r,A,T),g.call(s,E,r,A,P,T).then(function(e){return Object.defineProperty(i,Y,{value:e}),r})});throw new j(w("UpdateRecordMissing",p))}))}).then(function(e){var r,t;for(m.call(s,e,A,P,T),Object.defineProperty(f.response,"records",{configurable:!0,value:e}),r=0,t=B.length;r<t;r++){n=void 0;o=void 0;i=void 0;var n=B[r];var o=A;for(var i in n.replace)o.hasOwnProperty(i)||delete n.replace[i];for(i in n.pull)o.hasOwnProperty(i)||delete n.pull[i];for(i in n.push)o.hasOwnProperty(i)||delete n.push[i]}return E.update(k,B,T)}).then(function(){for(var e,r,t,n,o,i,s,u,a,f,c,l,p,h,d,y,m,g,v={},w=0,b=B.length;w<b;w++)for(p=B[w],d=0,y=P.length;d<y;d++)if(e=A[h=P[d]][z]){if(r=A[h][V],t=A[h][F],n=_[t][e][V],I[t]||(I[t]=[]),v[t]||(v[t]={}),i=p[K],o=p[Y],p.replace&&p.replace.hasOwnProperty(h)){if(f=p.replace[h],!Array.isArray(f)){if(f===i[h])continue;null!==f&&R(p[L],U(t,f,I,v),e,n),o[h]&&null!==o[h][e]&&!n&&o[h][e]!==p[L]&&x(f,U(k,o[h][e],I,v),h,n),null!==i[h]&&i[h]!==p[h]&&i[h]!==f&&x(p[L],U(t,i[h],I,v),e,n);continue}for(a=f,m=0,g=i[h].length;m<g;m++)f=i[h][m],C(a,f)||("pull"in p||(p.pull={}),p.pull.hasOwnProperty(h)?Array.isArray(p.pull[h])?p.pull[h].push(f):p.pull[h]=[p.pull[h],f]:p.pull[h]=[f]);for(m=0,g=a.length;m<g;m++)f=a[m],C(i[h],f)||("push"in p||(p.push={}),p.push.hasOwnProperty(h)?Array.isArray(p.push[h])?p.push[h].push(f):p.push[h]=[p.push[h],f]:p.push[h]=[f]);delete p.replace[h]}if(p.pull&&p.pull[h])for(m=0,g=(l=Array.isArray(p.pull[h])?p.pull[h]:[p.pull[h]]).length;m<g;m++)null!==(f=l[m])&&x(p[L],U(t,f,I,v),e,n);if(p.push&&p.push[h])for(m=0,g=(c=Array.isArray(p.push[h])?p.push[h]:[p.push[h]]).length;m<g;m++)null!==(f=c[m])&&R(p[L],U(t,f,I,v),e,n);if(o[h]&&!n)for(m=0,g=(u=Array.isArray(o[h])?o[h]:[o[h]]).length;m<g;m++)(s=u[m])[e]!==p[L]&&x(s[L],U(k,s[e],I,v),h,r)}return O.all(D(Object.keys(I),function(e){return I[e].length?E.update(e,I[e],T):null}))}).then(function(){var e,r={};for(e in r[N]={},r[N][k]=B,I)i(I[e],t),I[e].length&&(e!==k?r[N][e]=I[e]:r[N][k]=r[N][k].concat(I[k]));return s.emit(M,r),f})}},{"../common/apply_update":6,"../common/array/find":8,"../common/array/includes":9,"../common/array/map":10,"../common/assign":14,"../common/clone":17,"../common/constants":18,"../common/deep_equal":19,"../common/errors":20,"../common/message":25,"../common/promise":28,"../record_type/enforce":33,"./check_links":36,"./update_helpers":44,"./validate_records":45}],44:[function(e,r,t){"use strict";var i=e("../common/array/find"),s=e("../common/keys").primary;t.getUpdate=function(e,r,t,n){var o;return n[e]&&n[e][r]?i(t[e],function(e){return e[s]===r}):(o={id:r},t[e]||(t[e]=[]),t[e].push(o),n[e]||(n[e]={}),n[e][r]=!0,o)},t.addId=function(e,r,t,n){n?(r.push||(r.push={}),r.push[t]||(r.push[t]=[]),r.push[t].push(e)):(r.replace||(r.replace={}),r.replace[t]=e)},t.removeId=function(e,r,t,n){n?(r.pull||(r.pull={}),r.pull[t]||(r.pull[t]=[]),r.pull[t].push(e)):(r.replace||(r.replace={}),r.replace[t]=null)},t.scrubDenormalizedUpdates=function(e,r){for(var t,n,o,i=e.length;i--;){for(n in t=e[i])if(n!==s){for(o in t[n])o in r&&delete t[n][o];Object.keys(t[n]).length||delete t[n]}1===Object.keys(t).length&&e.splice(i,1)}}},{"../common/array/find":8,"../common/keys":24}],45:[function(e,r,t){"use strict";var A=e("../common/message"),k=e("../common/errors").ConflictError,e=e("../common/keys"),T=e.link,O=e.isArray,_=e.inverse;r.exports=function(e,r,t,n){for(var o,i,s,u,a,f,c,l,p,h,d,y,m,g=this.recordTypes,v=n.language,w={},b=0,E=t.length;b<E;b++){if(m=r[f=t[b]][T],d=r[f][_],y=r[f][O],m=g[m][d][O],y)for(o=0,i=e.length;o<i;o++)if(c=e[o],Array.isArray(c[f]))for(h={},s=0,u=(p=c[f]).length;s<u;s++){if(l=p[s],h.hasOwnProperty(l))throw new k(A("CollisionDuplicate",v,{id:l,field:f}));h[l]=!0}if(!m)for(w[f]={},o=0,i=e.length;o<i;o++)for(a=(c=e[o])[f],s=0,u=(p=Array.isArray(a)?a:a?[a]:[]).length;s<u;s++){if(l=p[s],w[f].hasOwnProperty(l))throw new k(A("CollisionToOne",v,{field:f}));w[f][l]=!0}}}},{"../common/errors":20,"../common/keys":24,"../common/message":25}],46:[function(e,r,t){"use strict";t.byteLength=function(e){var e=c(e),r=e[0],e=e[1];return 3*(r+e)/4-e},t.toByteArray=function(e){var r,t,n=c(e),o=n[0],n=n[1],i=new f(function(e,r){return 3*(e+r)/4-r}(o,n)),s=0,u=0<n?o-4:o;for(t=0;t<u;t+=4)r=a[e.charCodeAt(t)]<<18|a[e.charCodeAt(t+1)]<<12|a[e.charCodeAt(t+2)]<<6|a[e.charCodeAt(t+3)],i[s++]=r>>16&255,i[s++]=r>>8&255,i[s++]=255&r;2===n&&(r=a[e.charCodeAt(t)]<<2|a[e.charCodeAt(t+1)]>>4,i[s++]=255&r);1===n&&(r=a[e.charCodeAt(t)]<<10|a[e.charCodeAt(t+1)]<<4|a[e.charCodeAt(t+2)]>>2,i[s++]=r>>8&255,i[s++]=255&r);return i},t.fromByteArray=function(e){for(var r,t=e.length,n=t%3,o=[],i=0,s=t-n;i<s;i+=16383)o.push(function(e,r,t){for(var n,o=[],i=r;i<t;i+=3)n=(e[i]<<16&16711680)+(e[i+1]<<8&65280)+(255&e[i+2]),o.push(function(e){return u[e>>18&63]+u[e>>12&63]+u[e>>6&63]+u[63&e]}(n));return o.join("")}(e,i,s<i+16383?s:i+16383));1==n?(r=e[t-1],o.push(u[r>>2]+u[r<<4&63]+"==")):2==n&&(r=(e[t-2]<<8)+e[t-1],o.push(u[r>>10]+u[r>>4&63]+u[r<<2&63]+"="));return o.join("")};for(var u=[],a=[],f="undefined"!=typeof Uint8Array?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,i=n.length;o<i;++o)u[o]=n[o],a[n.charCodeAt(o)]=o;function c(e){var r=e.length;if(0<r%4)throw new Error("Invalid string. Length must be a multiple of 4");e=e.indexOf("="),r=(e=-1===e?r:e)===r?0:4-e%4;return[e,r]}a["-".charCodeAt(0)]=62,a["_".charCodeAt(0)]=63},{}],47:[function(R,e,x){!function(e){!function(){"use strict";var T=R("base64-js"),i=R("ieee754"),r=(x.Buffer=l,x.SlowBuffer=function(e){+e!=e&&(e=0);return l.alloc(+e)},x.INSPECT_MAX_BYTES=50,2147483647);function a(e){if(r<e)throw new RangeError('The value "'+e+'" is invalid for option "size"');e=new Uint8Array(e);return e.__proto__=l.prototype,e}function l(e,r,t){if("number"!=typeof e)return n(e,r,t);if("string"==typeof r)throw new TypeError('The "string" argument must be of type string. Received type number');return s(e)}function n(e,r,t){if("string"==typeof e){var n=e,o=r;if(l.isEncoding(o="string"==typeof o&&""!==o?o:"utf8"))return i=0|p(n,o),s=a(i),s=(n=s.write(n,o))!==i?s.slice(0,n):s;throw new TypeError("Unknown encoding: "+o)}if(ArrayBuffer.isView(e))return f(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(P(e,ArrayBuffer)||e&&P(e.buffer,ArrayBuffer)){var i=e,n=r,s=t;if(n<0||i.byteLength<n)throw new RangeError('"offset" is outside of buffer bounds');if(i.byteLength<n+(s||0))throw new RangeError('"length" is outside of buffer bounds');return(i=void 0===n&&void 0===s?new Uint8Array(i):void 0===s?new Uint8Array(i,n):new Uint8Array(i,n,s)).__proto__=l.prototype,i}if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');o=e.valueOf&&e.valueOf();if(null!=o&&o!==e)return l.from(o,r,t);var u=function(e){{var r,t;if(l.isBuffer(e))return r=0|c(e.length),0!==(t=a(r)).length&&e.copy(t,0,0,r),t}if(void 0!==e.length)return"number"!=typeof e.length||U(e.length)?a(0):f(e);if("Buffer"===e.type&&Array.isArray(e.data))return f(e.data)}(e);if(u)return u;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return l.from(e[Symbol.toPrimitive]("string"),r,t);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function o(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function s(e){return o(e),a(e<0?0:0|c(e))}function f(e){for(var r=e.length<0?0:0|c(e.length),t=a(r),n=0;n<r;n+=1)t[n]=255&e[n];return t}function c(e){if(r<=e)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r.toString(16)+" bytes");return 0|e}function p(e,r){if(l.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||P(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var t=e.length,n=2<arguments.length&&!0===arguments[2];if(!n&&0===t)return 0;for(var o=!1;;)switch(r){case"ascii":case"latin1":case"binary":return t;case"utf8":case"utf-8":return _(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*t;case"hex":return t>>>1;case"base64":return I(e).length;default:if(o)return n?-1:_(e).length;r=(""+r).toLowerCase(),o=!0}}function t(e,r,t){var n,o=!1;if((r=void 0===r||r<0?0:r)>this.length)return"";if((t=void 0===t||t>this.length?this.length:t)<=0)return"";if((t>>>=0)<=(r>>>=0))return"";for(e=e||"utf8";;)switch(e){case"hex":var i=this,s=r,u=t,a=i.length;(!u||u<0||a<u)&&(u=a);for(var f="",c=s=!s||s<0?0:s;c<u;++c)f+=function(e){return e<16?"0"+e.toString(16):e.toString(16)}(i[c]);return f;case"utf8":case"utf-8":return O(this,r,t);case"ascii":var l=this,a=r,p=t,h="";p=Math.min(l.length,p);for(var d=a;d<p;++d)h+=String.fromCharCode(127&l[d]);return h;case"latin1":case"binary":var y=this,s=r,m=t,g="";m=Math.min(y.length,m);for(var v=s;v<m;++v)g+=String.fromCharCode(y[v]);return g;case"base64":return w=this,n=t,0===(b=r)&&n===w.length?T.fromByteArray(w):T.fromByteArray(w.slice(b,n));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":for(var w=r,b=t,E=this.slice(w,b),A="",k=0;k<E.length;k+=2)A+=String.fromCharCode(E[k]+256*E[k+1]);return A;default:if(o)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}}function u(e,r,t){var n=e[r];e[r]=e[t],e[t]=n}function h(e,r,t,n,o){if(0===e.length)return-1;if("string"==typeof t?(n=t,t=0):2147483647<t?t=2147483647:t<-2147483648&&(t=-2147483648),(t=(t=U(t=+t)?o?0:e.length-1:t)<0?e.length+t:t)>=e.length){if(o)return-1;t=e.length-1}else if(t<0){if(!o)return-1;t=0}if("string"==typeof r&&(r=l.from(r,n)),l.isBuffer(r))return 0===r.length?-1:d(e,r,t,n,o);if("number"==typeof r)return r&=255,"function"==typeof Uint8Array.prototype.indexOf?(o?Uint8Array.prototype.indexOf:Uint8Array.prototype.lastIndexOf).call(e,r,t):d(e,[r],t,n,o);throw new TypeError("val must be string, number or Buffer")}function d(e,r,t,n,o){var i=1,s=e.length,u=r.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||r.length<2)return-1;s/=i=2,u/=2,t/=2}function a(e,r){return 1===i?e[r]:e.readUInt16BE(r*i)}if(o)for(var f=-1,c=t;c<s;c++)if(a(e,c)===a(r,-1===f?0:c-f)){if(c-(f=-1===f?c:f)+1===u)return f*i}else-1!==f&&(c-=c-f),f=-1;else for(c=t=s<t+u?s-u:t;0<=c;c--){for(var l=!0,p=0;p<u;p++)if(a(e,c+p)!==a(r,p)){l=!1;break}if(l)return c}return-1}function m(e,r,t,n){return B(function(e){for(var r=[],t=0;t<e.length;++t)r.push(255&e.charCodeAt(t));return r}(r),e,t,n)}function g(e,r,t,n){return B(function(e,r){for(var t,n,o=[],i=0;i<e.length&&!((r-=2)<0);++i)t=e.charCodeAt(i),n=t>>8,o.push(t%256),o.push(n);return o}(r,e.length-t),e,t,n)}function O(e,r,t){t=Math.min(e.length,t);for(var n=[],o=r;o<t;){var i,s,u,a,f=e[o],c=null,l=239<f?4:223<f?3:191<f?2:1;if(o+l<=t)switch(l){case 1:f<128&&(c=f);break;case 2:128==(192&(i=e[o+1]))&&127<(a=(31&f)<<6|63&i)&&(c=a);break;case 3:i=e[o+1],s=e[o+2],128==(192&i)&&128==(192&s)&&2047<(a=(15&f)<<12|(63&i)<<6|63&s)&&(a<55296||57343<a)&&(c=a);break;case 4:i=e[o+1],s=e[o+2],u=e[o+3],128==(192&i)&&128==(192&s)&&128==(192&u)&&65535<(a=(15&f)<<18|(63&i)<<12|(63&s)<<6|63&u)&&a<1114112&&(c=a)}null===c?(c=65533,l=1):65535<c&&(n.push((c-=65536)>>>10&1023|55296),c=56320|1023&c),n.push(c),o+=l}var p=n,h=p.length;if(h<=v)return String.fromCharCode.apply(String,p);for(var d="",y=0;y<h;)d+=String.fromCharCode.apply(String,p.slice(y,y+=v));return d}x.kMaxLength=r,(l.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}())||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&l[Symbol.species]===l&&Object.defineProperty(l,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),l.poolSize=8192,l.from=n,l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,l.alloc=function(e,r,t){return r=r,t=t,o(e=e),!(e<=0)&&void 0!==r?"string"==typeof t?a(e).fill(r,t):a(e).fill(r):a(e)},l.allocUnsafe=s,l.allocUnsafeSlow=s,l.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==l.prototype},l.compare=function(e,r){if(P(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),P(r,Uint8Array)&&(r=l.from(r,r.offset,r.byteLength)),!l.isBuffer(e)||!l.isBuffer(r))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===r)return 0;for(var t=e.length,n=r.length,o=0,i=Math.min(t,n);o<i;++o)if(e[o]!==r[o]){t=e[o],n=r[o];break}return t<n?-1:n<t?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,r){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);if(void 0===r)for(o=r=0;o<e.length;++o)r+=e[o].length;for(var t=l.allocUnsafe(r),n=0,o=0;o<e.length;++o){var i=e[o];if(P(i,Uint8Array)&&(i=l.from(i)),!l.isBuffer(i))throw new TypeError('"list" argument must be an Array of Buffers');i.copy(t,n),n+=i.length}return t},l.byteLength=p,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var r=0;r<e;r+=2)u(this,r,r+1);return this},l.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var r=0;r<e;r+=4)u(this,r,r+3),u(this,r+1,r+2);return this},l.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var r=0;r<e;r+=8)u(this,r,r+7),u(this,r+1,r+6),u(this,r+2,r+5),u(this,r+3,r+4);return this},l.prototype.toLocaleString=l.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?O(this,0,e):t.apply(this,arguments)},l.prototype.equals=function(e){if(l.isBuffer(e))return this===e||0===l.compare(this,e);throw new TypeError("Argument must be a Buffer")},l.prototype.inspect=function(){var e="",r=x.INSPECT_MAX_BYTES,e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim();return this.length>r&&(e+=" ... "),"<Buffer "+e+">"},l.prototype.compare=function(e,r,t,n,o){if(P(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),!l.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=e?e.length:0),void 0===n&&(n=0),void 0===o&&(o=this.length),(r=void 0===r?0:r)<0||t>e.length||n<0||o>this.length)throw new RangeError("out of range index");if(o<=n&&t<=r)return 0;if(o<=n)return-1;if(t<=r)return 1;if(this===e)return 0;for(var i=(o>>>=0)-(n>>>=0),s=(t>>>=0)-(r>>>=0),u=Math.min(i,s),a=this.slice(n,o),f=e.slice(r,t),c=0;c<u;++c)if(a[c]!==f[c]){i=a[c],s=f[c];break}return i<s?-1:s<i?1:0},l.prototype.includes=function(e,r,t){return-1!==this.indexOf(e,r,t)},l.prototype.indexOf=function(e,r,t){return h(this,e,r,t,!0)},l.prototype.lastIndexOf=function(e,r,t){return h(this,e,r,t,!1)},l.prototype.write=function(e,r,t,n){if(void 0===r)n="utf8",t=this.length,r=0;else if(void 0===t&&"string"==typeof r)n=r,t=this.length,r=0;else{if(!isFinite(r))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");r>>>=0,isFinite(t)?(t>>>=0,void 0===n&&(n="utf8")):(n=t,t=void 0)}var o=this.length-r;if((void 0===t||o<t)&&(t=o),0<e.length&&(t<0||r<0)||r>this.length)throw new RangeError("Attempt to write outside buffer bounds");n=n||"utf8";for(var i,s,u,a=!1;;)switch(n){case"hex":var f=this,c=e,l=r,p=t,h=(l=Number(l)||0,f.length-l);(!p||h<(p=Number(p)))&&(p=h),(h=c.length)/2<p&&(p=h/2);for(var d=0;d<p;++d){var y=parseInt(c.substr(2*d,2),16);if(U(y))return d;f[l+d]=y}return d;case"utf8":case"utf-8":return h=r,u=t,B(_(e,(s=this).length-h),s,h,u);case"ascii":return m(this,e,r,t);case"latin1":case"binary":return m(this,e,r,t);case"base64":return s=this,u=r,i=t,B(I(e),s,u,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return g(this,e,r,t);default:if(a)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),a=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var v=4096;function y(e,r,t){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(t<e+r)throw new RangeError("Trying to access beyond buffer length")}function w(e,r,t,n,o,i){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(o<r||r<i)throw new RangeError('"value" argument is out of bounds');if(t+n>e.length)throw new RangeError("Index out of range")}function b(e,r,t,n){if(t+n>e.length)throw new RangeError("Index out of range");if(t<0)throw new RangeError("Index out of range")}function E(e,r,t,n,o){return r=+r,t>>>=0,o||b(e,0,t,4),i.write(e,r,t,n,23,4),t+4}function A(e,r,t,n,o){return r=+r,t>>>=0,o||b(e,0,t,8),i.write(e,r,t,n,52,8),t+8}l.prototype.slice=function(e,r){var t=this.length,t=((e=~~e)<0?(e+=t)<0&&(e=0):t<e&&(e=t),(r=void 0===r?t:~~r)<0?(r+=t)<0&&(r=0):t<r&&(r=t),r<e&&(r=e),this.subarray(e,r));return t.__proto__=l.prototype,t},l.prototype.readUIntLE=function(e,r,t){e>>>=0,r>>>=0,t||y(e,r,this.length);for(var n=this[e],o=1,i=0;++i<r&&(o*=256);)n+=this[e+i]*o;return n},l.prototype.readUIntBE=function(e,r,t){e>>>=0,r>>>=0,t||y(e,r,this.length);for(var n=this[e+--r],o=1;0<r&&(o*=256);)n+=this[e+--r]*o;return n},l.prototype.readUInt8=function(e,r){return e>>>=0,r||y(e,1,this.length),this[e]},l.prototype.readUInt16LE=function(e,r){return e>>>=0,r||y(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUInt16BE=function(e,r){return e>>>=0,r||y(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUInt32LE=function(e,r){return e>>>=0,r||y(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUInt32BE=function(e,r){return e>>>=0,r||y(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readIntLE=function(e,r,t){e>>>=0,r>>>=0,t||y(e,r,this.length);for(var n=this[e],o=1,i=0;++i<r&&(o*=256);)n+=this[e+i]*o;return(o*=128)<=n&&(n-=Math.pow(2,8*r)),n},l.prototype.readIntBE=function(e,r,t){e>>>=0,r>>>=0,t||y(e,r,this.length);for(var n=r,o=1,i=this[e+--n];0<n&&(o*=256);)i+=this[e+--n]*o;return(o*=128)<=i&&(i-=Math.pow(2,8*r)),i},l.prototype.readInt8=function(e,r){return e>>>=0,r||y(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,r){e>>>=0,r||y(e,2,this.length);r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},l.prototype.readInt16BE=function(e,r){e>>>=0,r||y(e,2,this.length);r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},l.prototype.readInt32LE=function(e,r){return e>>>=0,r||y(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,r){return e>>>=0,r||y(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readFloatLE=function(e,r){return e>>>=0,r||y(e,4,this.length),i.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,r){return e>>>=0,r||y(e,4,this.length),i.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,r){return e>>>=0,r||y(e,8,this.length),i.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,r){return e>>>=0,r||y(e,8,this.length),i.read(this,e,!1,52,8)},l.prototype.writeUIntLE=function(e,r,t,n){e=+e,r>>>=0,t>>>=0,n||w(this,e,r,t,Math.pow(2,8*t)-1,0);var o=1,i=0;for(this[r]=255&e;++i<t&&(o*=256);)this[r+i]=e/o&255;return r+t},l.prototype.writeUIntBE=function(e,r,t,n){e=+e,r>>>=0,t>>>=0,n||w(this,e,r,t,Math.pow(2,8*t)-1,0);var o=t-1,i=1;for(this[r+o]=255&e;0<=--o&&(i*=256);)this[r+o]=e/i&255;return r+t},l.prototype.writeUInt8=function(e,r,t){return e=+e,r>>>=0,t||w(this,e,r,1,255,0),this[r]=255&e,r+1},l.prototype.writeUInt16LE=function(e,r,t){return e=+e,r>>>=0,t||w(this,e,r,2,65535,0),this[r]=255&e,this[r+1]=e>>>8,r+2},l.prototype.writeUInt16BE=function(e,r,t){return e=+e,r>>>=0,t||w(this,e,r,2,65535,0),this[r]=e>>>8,this[r+1]=255&e,r+2},l.prototype.writeUInt32LE=function(e,r,t){return e=+e,r>>>=0,t||w(this,e,r,4,4294967295,0),this[r+3]=e>>>24,this[r+2]=e>>>16,this[r+1]=e>>>8,this[r]=255&e,r+4},l.prototype.writeUInt32BE=function(e,r,t){return e=+e,r>>>=0,t||w(this,e,r,4,4294967295,0),this[r]=e>>>24,this[r+1]=e>>>16,this[r+2]=e>>>8,this[r+3]=255&e,r+4},l.prototype.writeIntLE=function(e,r,t,n){e=+e,r>>>=0,n||w(this,e,r,t,(n=Math.pow(2,8*t-1))-1,-n);var o=0,i=1,s=0;for(this[r]=255&e;++o<t&&(i*=256);)e<0&&0===s&&0!==this[r+o-1]&&(s=1),this[r+o]=(e/i>>0)-s&255;return r+t},l.prototype.writeIntBE=function(e,r,t,n){e=+e,r>>>=0,n||w(this,e,r,t,(n=Math.pow(2,8*t-1))-1,-n);var o=t-1,i=1,s=0;for(this[r+o]=255&e;0<=--o&&(i*=256);)e<0&&0===s&&0!==this[r+o+1]&&(s=1),this[r+o]=(e/i>>0)-s&255;return r+t},l.prototype.writeInt8=function(e,r,t){return e=+e,r>>>=0,t||w(this,e,r,1,127,-128),this[r]=255&(e=e<0?255+e+1:e),r+1},l.prototype.writeInt16LE=function(e,r,t){return e=+e,r>>>=0,t||w(this,e,r,2,32767,-32768),this[r]=255&e,this[r+1]=e>>>8,r+2},l.prototype.writeInt16BE=function(e,r,t){return e=+e,r>>>=0,t||w(this,e,r,2,32767,-32768),this[r]=e>>>8,this[r+1]=255&e,r+2},l.prototype.writeInt32LE=function(e,r,t){return e=+e,r>>>=0,t||w(this,e,r,4,2147483647,-2147483648),this[r]=255&e,this[r+1]=e>>>8,this[r+2]=e>>>16,this[r+3]=e>>>24,r+4},l.prototype.writeInt32BE=function(e,r,t){return e=+e,r>>>=0,t||w(this,e,r,4,2147483647,-2147483648),this[r]=(e=e<0?4294967295+e+1:e)>>>24,this[r+1]=e>>>16,this[r+2]=e>>>8,this[r+3]=255&e,r+4},l.prototype.writeFloatLE=function(e,r,t){return E(this,e,r,!0,t)},l.prototype.writeFloatBE=function(e,r,t){return E(this,e,r,!1,t)},l.prototype.writeDoubleLE=function(e,r,t){return A(this,e,r,!0,t)},l.prototype.writeDoubleBE=function(e,r,t){return A(this,e,r,!1,t)},l.prototype.copy=function(e,r,t,n){if(!l.isBuffer(e))throw new TypeError("argument should be a Buffer");if(t=t||0,n||0===n||(n=this.length),r>=e.length&&(r=e.length),(n=0<n&&n<t?t:n)===t)return 0;if(0===e.length||0===this.length)return 0;if((r=r||0)<0)throw new RangeError("targetStart out of bounds");if(t<0||t>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length);var o=(n=e.length-r<n-t?e.length-r+t:n)-t;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(r,t,n);else if(this===e&&t<r&&r<n)for(var i=o-1;0<=i;--i)e[i+r]=this[i+t];else Uint8Array.prototype.set.call(e,this.subarray(t,n),r);return o},l.prototype.fill=function(e,r,t,n){if("string"==typeof e){if("string"==typeof r?(n=r,r=0,t=this.length):"string"==typeof t&&(n=t,t=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!l.isEncoding(n))throw new TypeError("Unknown encoding: "+n);var o;1===e.length&&(o=e.charCodeAt(0),"utf8"===n&&o<128||"latin1"===n)&&(e=o)}else"number"==typeof e&&(e&=255);if(r<0||this.length<r||this.length<t)throw new RangeError("Out of range index");var i;if(!(t<=r))if(r>>>=0,t=void 0===t?this.length:t>>>0,"number"==typeof(e=e||0))for(i=r;i<t;++i)this[i]=e;else{var s=l.isBuffer(e)?e:l.from(e,n),u=s.length;if(0===u)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<t-r;++i)this[i+r]=s[i%u]}return this};var k=/[^+/0-9A-Za-z-_]/g;function _(e,r){r=r||1/0;for(var t,n=e.length,o=null,i=[],s=0;s<n;++s){if(55295<(t=e.charCodeAt(s))&&t<57344){if(!o){if(56319<t){-1<(r-=3)&&i.push(239,191,189);continue}if(s+1===n){-1<(r-=3)&&i.push(239,191,189);continue}o=t;continue}if(t<56320){-1<(r-=3)&&i.push(239,191,189),o=t;continue}t=65536+(o-55296<<10|t-56320)}else o&&-1<(r-=3)&&i.push(239,191,189);if(o=null,t<128){if(--r<0)break;i.push(t)}else if(t<2048){if((r-=2)<0)break;i.push(t>>6|192,63&t|128)}else if(t<65536){if((r-=3)<0)break;i.push(t>>12|224,t>>6&63|128,63&t|128)}else{if(!(t<1114112))throw new Error("Invalid code point");if((r-=4)<0)break;i.push(t>>18|240,t>>12&63|128,t>>6&63|128,63&t|128)}}return i}function I(e){return T.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(k,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function B(e,r,t,n){for(var o=0;o<n&&!(o+t>=r.length||o>=e.length);++o)r[o+t]=e[o];return o}function P(e,r){return e instanceof r||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===r.name}function U(e){return e!=e}}.call(this)}.call(this,R("buffer").Buffer)},{"base64-js":46,buffer:47,ieee754:50}],48:[function(e,r,t){"use strict";var n="captureStackTrace"in Error;function o(e){return{value:e,writable:!0,configurable:!0}}r.exports=function(e){var r;if(e&&"string"==typeof e)return(r=function e(){if(!(this instanceof e))return new(e.bind.apply(e,Array.prototype.concat.apply([null],arguments)));!function(e){n?Error.captureStackTrace(this,this.constructor):Object.defineProperty(this,"stack",o(Error(e).stack));Object.defineProperty(this,"message",o(void 0!==e?""+e:""))}.apply(this,arguments)}).prototype=Object.create(Error.prototype,{constructor:o(r),name:o(e)}),r;throw new TypeError('Argument "name" must be a non-empty string.')}},{}],49:[function(e,r,t){function n(e){for(var r in a)e[r]=a[r];return e}function o(e,r){var t,n=this;if(arguments.length){if(r){if(t=s(n,e,!0)){if(!(t=t.filter(function(e){return e!==r&&e.originalListener!==r})).length)return o.call(n,e);n[u][e]=t}}else if((t=n[u])&&(delete t[e],!Object.keys(t).length))return o.call(n)}else delete n[u];return n}function s(e,r,t){if(!t||e[u])return(t=e[u]||(e[u]={}))[r]||(t[r]=[])}var i,u,a;i=function e(){if(!(this instanceof e))return new e},void 0!==r&&(r.exports=i),u="listeners",a={on:function(e,r){return s(this,e).push(r),this},once:function(e,r){var t=this;return n.originalListener=r,s(t,e).push(n),t;function n(){o.call(t,e,n),r.apply(this,arguments)}},off:o,emit:function(e,r){var t=this,n=s(t,e,!0);if(!n)return!1;var o=arguments.length;{var i;1===o?n.forEach(function(e){e.call(t)}):2===o?n.forEach(function(e){e.call(t,r)}):(i=Array.prototype.slice.call(arguments,1),n.forEach(function(e){e.apply(t,i)}))}return!!n.length}},n(i.prototype),i.mixin=n},{}],50:[function(e,r,t){t.read=function(e,r,t,n,o){var i,s,u=8*o-n-1,a=(1<<u)-1,f=a>>1,c=-7,l=t?o-1:0,p=t?-1:1,o=e[r+l];for(l+=p,i=o&(1<<-c)-1,o>>=-c,c+=u;0<c;i=256*i+e[r+l],l+=p,c-=8);for(s=i&(1<<-c)-1,i>>=-c,c+=n;0<c;s=256*s+e[r+l],l+=p,c-=8);if(0===i)i=1-f;else{if(i===a)return s?NaN:1/0*(o?-1:1);s+=Math.pow(2,n),i-=f}return(o?-1:1)*s*Math.pow(2,i-n)},t.write=function(e,r,t,n,o,i){var s,u,a=8*i-o-1,f=(1<<a)-1,c=f>>1,l=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:i-1,h=n?1:-1,i=r<0||0===r&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(u=isNaN(r)?1:0,s=f):(s=Math.floor(Math.log(r)/Math.LN2),r*(n=Math.pow(2,-s))<1&&(s--,n*=2),2<=(r+=1<=s+c?l/n:l*Math.pow(2,1-c))*n&&(s++,n/=2),f<=s+c?(u=0,s=f):1<=s+c?(u=(r*n-1)*Math.pow(2,o),s+=c):(u=r*Math.pow(2,c-1)*Math.pow(2,o),s=0));8<=o;e[t+p]=255&u,p+=h,u/=256,o-=8);for(s=s<<o|u,a+=o;0<a;e[t+p]=255&s,p+=h,s/=256,a-=8);e[t+p-h]|=128*i}},{}],51:[function(e,r,t){function n(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}r.exports=function(e){return null!=e&&(n(e)||"function"==typeof(r=e).readFloatLE&&"function"==typeof r.slice&&n(r.slice(0,0))||!!e._isBuffer);var r}},{}]},{},[31]);
